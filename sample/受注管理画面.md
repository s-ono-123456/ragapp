## シート名: 受注管理_初期表示

外部設計書

| ドキュメント名 | 作成日／更新日 | 版 | 作成者／更新者 |
|---|---|---|---|
| 外部設計書_画面設計（受注管理） | 2025-04-19 | 1.0.0 | あなたのお名前 |

### 1. 前処理

#### 1.1. 権限チェック

・ログインユーザーの権限をチェックする。  
・受注管理画面へのアクセス権限を確認。

#### 1.2. リクエスト情報取得

・画面に表示する受注情報を取得する。

| ＃ | エリア名 | 画面項目名 |
|---|---|---|
| 1 | ヘッダー | 検索条件（受注番号、受注日、顧客名） |
| 2 | 本体 | 受注一覧テーブル（受注番号、受注日、顧客名、合計金額、ステータス） |

### 2. チェック処理

・処理なし。

### 3. 業務処理

#### 3.1. データ取得処理

##### 3.1.1. DBからデータを取得

| ＃ | DB名 | 画面項目名 |
|---|---|---|
| 1 | 受注 | 受注番号 |
| 2 | 受注 | 受注日 |
| 3 | 顧客 | 顧客名 |
| 4 | 受注明細 | 合計金額 |
| 5 | 受注 | ステータス |

#### 3.2. データ成形処理

##### 3.2.1. データ成型

・検索条件に一致する受注データを整形。

##### 3.2.2. 後処理

・取得データを画面表示形式に整形し表示。

---

## シート名: 受注管理_詳細表示ボタン

外部設計書

### 1. 前処理

#### 1.1. 権限チェック

・詳細表示の権限を確認。

#### 1.2. リクエスト情報取得

| ＃ | エリア名 | 画面項目名 |
|---|---|---|
| 1 | 本体 | 選択行の受注番号 |

### 2. チェック処理

・受注番号が取得できているか確認。

### 3. 業務処理

#### 3.1. 受注詳細取得処理

・受注番号をキーに、受注情報および受注明細をDBから取得。
・取得した情報を詳細表示用データ形式に整形。
・モーダルダイアログまたは別画面に表示する。

---

## シート名: 受注管理_受注確定ボタン

外部設計書

### 1. 前処理

#### 1.1. 権限チェック

・受注確定操作の権限を確認。

#### 1.2. リクエスト情報取得

| ＃ | エリア名 | 画面項目名 |
|---|---|---|
| 1 | 本体 | 受注番号 |

### 2. チェック処理

・対象の受注が「仮登録」状態であることを確認。
・既に確定されていないか確認。

### 3. 業務処理

#### 3.1. ステータス更新処理

・受注テーブルのステータスを「確定」に更新。
・確定日時と確定ユーザーIDを記録。
・更新結果を画面に反映。

---

## シート名: 受注管理_受注明細編集ボタン

外部設計書

### 1. 前処理

#### 1.1. 権限チェック

・明細編集の権限があるか確認。

#### 1.2. リクエスト情報取得

・編集対象の受注番号および明細情報を取得。

### 2. チェック処理

・明細内容に未入力項目がないか確認。
・単価、数量などが正の数であるか確認。

### 3. 業務処理

#### 3.1. 明細更新処理

・入力内容に基づき受注明細を一括更新（既存データは削除して再登録）。
・受注テーブルの合計金額を再計算。
・更新後、再取得して画面に反映。

---

## シート名: 受注管理_削除ボタン

外部設計書

### 1. 前処理

#### 1.1. 権限チェック

・削除権限を確認。

#### 1.2. リクエスト情報取得

・削除対象の受注番号を取得。

### 2. チェック処理

・対象の受注が「確定」状態でないことを確認。
・削除対象データの存在確認。

### 3. 業務処理

#### 3.1. 論理削除処理

・受注テーブルおよび受注明細テーブルの削除フラグをONに設定。
・削除ユーザー、削除日時を記録。
・削除後、一覧から該当行を非表示とする。

---

## シート名: 受注管理_CSV出力ボタン

外部設計書

### 1. 前処理

#### 1.1. 権限チェック

・CSV出力権限を確認。

#### 1.2. リクエスト情報取得

・検索条件を取得。

### 2. チェック処理

・検索条件の妥当性確認（入力必須チェック、形式チェック）。

### 3. 業務処理

#### 3.1. CSVデータ生成処理

・条件に合致する受注データを取得。
・CSVフォーマット（ヘッダー、エンコーディング）に従ってファイル生成。
・ユーザーへダウンロードリンクを返却。

