## シート名: 発送管理_初期表示

外部設計書

| ドキュメント名 | 作成日／更新日 | 版 | 作成者／更新者 |
|---|---|---|---|
| 外部設計書_画面設計（発送管理） | 2025-04-19 | 1.0.0 | あなたのお名前 |

### 1. 前処理

#### 1.1. 権限チェック

・ログインユーザーの権限をチェックする。
・発送管理画面へのアクセス権限を確認。

#### 1.2. リクエスト情報取得

・画面に表示する発送情報を取得する。

| ＃ | エリア名 | 画面項目名 |
|---|---|---|
| 1 | ヘッダー | 検索条件（発送番号、受注番号、発送日、ステータス） |
| 2 | 本体 | 発送一覧テーブル（発送番号、受注番号、顧客名、発送日、配送業者、ステータス） |

### 2. チェック処理

・処理なし。

### 3. 業務処理

#### 3.1. データ取得処理

##### 3.1.1. DBからデータを取得

| ＃ | DB名 | 画面項目名 |
|---|---|---|
| 1 | 発送 | 発送番号 |
| 2 | 受注 | 受注番号 |
| 3 | 顧客 | 顧客名 |
| 4 | 発送 | 発送日 |
| 5 | 発送 | 配送業者 |
| 6 | 発送 | ステータス |

#### 3.2. データ成形処理

##### 3.2.1. データ成型

・検索条件に一致する発送データを整形。

##### 3.2.2. 後処理

・取得データを画面表示形式に整形し表示。

---

## シート名: 発送管理_発送確定ボタン

### 1. 前処理

#### 1.1. 権限チェック

・発送確定処理の実行権限を確認。

#### 1.2. リクエスト情報取得

| ＃ | エリア名 | 画面項目名 |
|---|---|---|
| 1 | 本体 | 発送番号 |

### 2. チェック処理

・発送対象が未確定ステータスであることを確認。
・配送業者、発送日などの必須情報が入力されていることを確認。

### 3. 業務処理

#### 3.1. ステータス更新処理

・ステータスを「確定」に更新。
・発送確定日時・担当者を記録。
・一覧に反映。

---

## シート名: 発送管理_キャンセルボタン

### 1. 前処理

#### 1.1. 権限チェック

・キャンセル処理の実行権限を確認。

#### 1.2. リクエスト情報取得

・キャンセル対象の発送番号を取得。

### 2. チェック処理

・発送が未処理または確定済みであるかチェック。

### 3. 業務処理

#### 3.1. ステータス更新処理

・ステータスを「キャンセル」に変更。
・キャンセル理由、日時、担当者情報を記録。

---

## シート名: 発送管理_伝票出力ボタン

### 1. 前処理

#### 1.1. 権限チェック

・伝票出力の実行権限を確認。

#### 1.2. リクエスト情報取得

・発送番号を取得。

### 2. チェック処理

・発送情報が存在することを確認。

### 3. 業務処理

#### 3.1. 伝票PDF生成処理

・対象発送の伝票情報（顧客名、配送先、商品情報など）を取得。
・フォーマットに従いPDFを生成。
・ダウンロードリンクとして返却。

---

## シート名: 発送管理_配送状況確認ボタン

### 1. 前処理

#### 1.1. 権限チェック

・配送状況確認の権限を確認。

#### 1.2. リクエスト情報取得

・発送番号および配送業者情報を取得。

### 2. チェック処理

・配送業者のトラッキングURLが登録されていることを確認。

### 3. 業務処理

#### 3.1. 配送API連携処理

・配送業者APIまたは外部トラッキングURLに発送番号を連携。
・取得結果（配送ステータスや履歴）をモーダルまたは別ウィンドウで表示。

---

## シート名: 発送管理_CSV出力ボタン

### 1. 前処理

#### 1.1. 権限チェック

・CSV出力の実行権限を確認。

#### 1.2. リクエスト情報取得

・検索条件を取得。

### 2. チェック処理

・検索条件の妥当性を確認。

### 3. 業務処理

#### 3.1. CSVファイル生成処理

・検索条件に一致する発送データを取得。
・CSVフォーマットに変換（列順、エンコーディング設定）。
・ユーザーへファイルダウンロード提供。

